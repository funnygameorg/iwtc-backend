pipeline {
    agent any

    stages {

        stage('build : world-cup image') {
            steps {
                sh "sudo docker build --build-arg SPRING_PROFILES_ACTIVE=prod -f itwc-world-cup.Dockerfile -t itwc-world-cup ."
            }
        }

        stage('build : member image') {
            steps {
                sh "sudo docker build --build-arg SPRING_PROFILES_ACTIVE=prod -f itwc-member.Dockerfile -t itwc-member ."
            }
        }

        stage('run : world-cup image') {
            steps {
                sh 'sudo docker run -v ./logs:/logs -p 8080:8080 itwc-world-cup'
            }
        }

        stage('run : member image') {
            steps {
                sh 'sudo docker run -v ./logs:/logs -p 8081:8081 itwc-member'
            }
        }

        stage('remove : not used container & image') {
            steps {
                sh 'sudo docker container prune'
                sh 'sudo docker image prune'
            }
        }
    }

    post {

        always {
            echo 'bye!'
        }

    }

}